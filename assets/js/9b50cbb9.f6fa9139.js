"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[114],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(t),h=r,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||i;return t?a.createElement(m,o(o({ref:n},c),{},{components:t})):a.createElement(m,o({ref:n},c))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},1896:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const i={id:"version-and-publish",title:"Version and Publish",type:"explainer"},o="Version and Publish",s={unversionedId:"features/version-and-publish",id:"features/version-and-publish",title:"Version and Publish",description:"Lerna can increment your package's versions as well as publish your packages to NPM, and it provides a variety of options to make sure any workflow can be accommodated.",source:"@site/docs/features/version-and-publish.md",sourceDirName:"features",slug:"/features/version-and-publish",permalink:"/docs/features/version-and-publish",draft:!1,editUrl:"https://github.com/lerna/lerna/tree/main/website/docs/features/version-and-publish.md",tags:[],version:"current",frontMatter:{id:"version-and-publish",title:"Version and Publish",type:"explainer"},sidebar:"main",previous:{title:"Distribute Task Execution",permalink:"/docs/features/distribute-tasks"},next:{title:"Editor Integrations",permalink:"/docs/features/editor-integrations"}},l={},p=[{value:"Versioning",id:"versioning",level:2},{value:"Publishing to NPM",id:"publishing-to-npm",level:2},{value:"from-package",id:"from-package",level:3},{value:"Versioning strategies",id:"versioning-strategies",level:2},{value:"Fixed/Locked mode (default)",id:"fixedlocked-mode-default",level:3},{value:"Synchronized Versions",id:"synchronized-versions",level:4},{value:"Independent mode",id:"independent-mode",level:3}],c={toc:p};function u(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"version-and-publish"},"Version and Publish"),(0,r.kt)("p",null,"Lerna can increment your package's versions as well as publish your packages to NPM, and it provides a variety of options to make sure any workflow can be accommodated."),(0,r.kt)("p",null,"To show how Lerna does it, we will look at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/lerna/getting-started-example"},"this repository"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you learn better by doing, clone the repo and follow along.")),(0,r.kt)("p",null,"The repo contains three packages or projects:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"header")," (a library of React components)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"footer")," (a library of React components)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"remixapp")," (an app written using the Remix framework which depends on both ",(0,r.kt)("inlineCode",{parentName:"li"},"header")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"footer"),")")),(0,r.kt)("p",null,"We are going to publish the ",(0,r.kt)("inlineCode",{parentName:"p"},"header")," and the ",(0,r.kt)("inlineCode",{parentName:"p"},"footer")," packages."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"It's common to publish only a subset of the projects. Some projects can be private (e.g., used only for tests), some\ncan be demo apps. In this repo, ",(0,r.kt)("inlineCode",{parentName:"p"},"remixapp")," isn't private, it just doesn't get published to NPM.")),(0,r.kt)("h2",{id:"versioning"},"Versioning"),(0,r.kt)("p",null,"Lerna comes with a ",(0,r.kt)("inlineCode",{parentName:"p"},"version")," command that allows you to increment your package's version number, commit the changes and tag them accordingly."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"lerna version --no-private\n")),(0,r.kt)("p",null,"you'll get the following output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"lerna notice cli v5.1.2\nlerna info current version 1.0.0\nlerna info Assuming all packages changed\n? Select a new version (currently 1.0.0) (Use arrow keys)\n\u276f Patch (1.0.1)\n  Minor (1.1.0)\n  Major (2.0.0)\n  Prepatch (1.0.1-alpha.0)\n  Preminor (1.1.0-alpha.0)\n  Premajor (2.0.0-alpha.0)\n  Custom Prerelease\n  Custom Version\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Note that by passing ",(0,r.kt)("inlineCode",{parentName:"p"},"--no-private")," we exclude all packages that are marked ",(0,r.kt)("inlineCode",{parentName:"p"},"private")," in their ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," file.")),(0,r.kt)("p",null,"Lerna detects the current packages, identifies the current version and proposes the next one to choose. Note, you can also pass a semver bump directly like ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna version 1.0.0"),". More on the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/lerna/lerna/tree/main/libs/commands/version#readme"},"version docs details"),". Once a given version is chosen, Lerna updates the ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," with the version number, commits the change, adds a corresponding version tag (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.0.0"),") and pushes the commit and the tag to the remote repository."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="packages/footer/package.json"',title:'"packages/footer/package.json"'},'{\n  "name": "footer",\n  "version": "1.0.1",\n  "main": "dist/index.js",\n  ...\n}\n')),(0,r.kt)("p",null,"Note the above operation does not push the package to any NPM repository. If instead we also want Lerna to take care of the publishing process, we can use ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna publish")," instead."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Lerna uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"version")," property in ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna.json")," to determine the currently used version")),(0,r.kt)("h2",{id:"publishing-to-npm"},"Publishing to NPM"),(0,r.kt)("p",null,"If we run"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"lerna publish --no-private\n")),(0,r.kt)("p",null,"Lerna executes the version incrementing workflow (same as ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna version"),") and in addition also pushes the packages to NPM. You should get the following output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Terminal Output"',title:'"Terminal','Output"':!0},"lerna notice cli v5.1.2\nlerna info current version 1.0.0\nlerna info Assuming all packages changed\n? Select a new version (currently 1.0.0) Patch (1.0.1)\n\nChanges:\n - footer: 1.0.0 => 1.0.1\n - header: 1.0.0 => 1.0.1\n\n? Are you sure you want to publish these packages? Yes\nlerna info execute Skipping releases\nlerna info git Pushing tags...\nlerna info publish Publishing packages to npm...\n...\nlerna success published header 1.0.1\n...\nlerna success published footer 1.0.1\n...\nSuccessfully published:\n - footer@1.0.1\n - header@1.0.1\nlerna success published 2 packages\n")),(0,r.kt)("h3",{id:"from-package"},"from-package"),(0,r.kt)("p",null,"Another way Lerna can determine which packages to publish is with ",(0,r.kt)("inlineCode",{parentName:"p"},"from-package"),". Lerna will compare the version of every package in the repository with the version of it that is published to npm. For each package that has a version that is greater than the published version, Lerna will publish that package to npm."),(0,r.kt)("p",null,"This mode does not explicitly require that the packages have been versioned with ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna version"),", which makes it great for workspaces that have their own versioning scripts."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"lerna publish from-package\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Lerna ",(0,r.kt)("em",{parentName:"p"},"always")," uses ",(0,r.kt)("inlineCode",{parentName:"p"},"npm")," to publish packages. If you use a package manager other than ",(0,r.kt)("inlineCode",{parentName:"p"},"npm"),", you will need to still add the appropriate publishing configuration to ",(0,r.kt)("inlineCode",{parentName:"p"},".npmrc"),", even if ",(0,r.kt)("inlineCode",{parentName:"p"},"npmClient")," is set to something other than ",(0,r.kt)("inlineCode",{parentName:"p"},"npm")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna.json"),".")),(0,r.kt)("h2",{id:"versioning-strategies"},"Versioning strategies"),(0,r.kt)("p",null,"Lerna allows you to manage your project using one of two modes: Fixed or Independent."),(0,r.kt)("h3",{id:"fixedlocked-mode-default"},"Fixed/Locked mode (default)"),(0,r.kt)("p",null,"Fixed mode Lerna projects operate on a single version line. The version is kept in the ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna.json")," file at the root of your project under the ",(0,r.kt)("inlineCode",{parentName:"p"},"version")," key. When you run ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna publish"),", if a package has been updated since the last time a release was made, it will be updated to the new version you're releasing. This means that you only publish a new version of a package when you need to."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: If you have a major version zero, all updates are ",(0,r.kt)("a",{parentName:"p",href:"https://semver.org/#spec-item-4"},"considered breaking"),". Because of that, running ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna publish")," with a major version zero and choosing any non-prerelease version number will cause new versions to be published for all packages, even if not all packages have changed since the last release.")),(0,r.kt)("p",null,"Use this if you want to automatically tie all package versions together. One issue with this approach is that a major change in any package will result in all packages having a new major version."),(0,r.kt)("h4",{id:"synchronized-versions"},"Synchronized Versions"),(0,r.kt)("p",null,"Lerna will only version and publish packages that have changed since the previous release, causing package versions to drift apart over time. To prevent this, use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--force-publish")," option with ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna version"),". This will force Lerna to always version all packages, regardless of if they have changed since the previous release. Then they will all be published to the registry by ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna publish from-git"),". As a result, all package versions will stay synchronized to the version in ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna.json"),"."),(0,r.kt)("h3",{id:"independent-mode"},"Independent mode"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"npx lerna init --independent")),(0,r.kt)("p",null,"Independent mode Lerna projects allows maintainers to increment package versions independently of each other. Each time you publish, you will get a prompt for each package that has changed to specify if it's a patch, minor, major or custom change."),(0,r.kt)("p",null,"Independent mode allows you to more specifically update versions for each package and makes sense for a group of components. Combining this mode with something like ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/semantic-release/semantic-release"},"semantic-release")," would make it less painful. (There is work on this already at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/atlassian/lerna-semantic-release"},"atlassian/lerna-semantic-release"),")."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Set the ",(0,r.kt)("inlineCode",{parentName:"p"},"version")," key in ",(0,r.kt)("inlineCode",{parentName:"p"},"lerna.json")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"independent")," to run in independent mode.")))}u.isMDXComponent=!0}}]);