"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[663],{3905:(e,a,n)=>{n.d(a,{Zo:()=>d,kt:()=>u});var t=n(7294);function i(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function r(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){i(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,t,i=function(e,a){if(null==e)return{};var n,t,i={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||(i[n]=e[n]);return i}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=t.createContext({}),s=function(e){var a=t.useContext(p),n=a;return e&&(n="function"==typeof e?e(a):r(r({},a),e)),n},d=function(e){var a=s(e.components);return t.createElement(p.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},m=t.forwardRef((function(e,a){var n=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=s(n),u=i,k=m["".concat(p,".").concat(u)]||m[u]||c[u]||o;return n?t.createElement(k,r(r({ref:a},d),{},{components:n})):t.createElement(k,r({ref:a},d))}));function u(e,a){var n=arguments,i=a&&a.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=m;var l={};for(var p in a)hasOwnProperty.call(a,p)&&(l[p]=a[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var s=2;s<o;s++)r[s]=n[s];return t.createElement.apply(null,r)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5404:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>p,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var t=n(7462),i=(n(7294),n(3905));const o={id:"legacy-package-management",title:"Legacy Package Management",type:"explainer"},r="Legacy Package Management",l={unversionedId:"legacy-package-management",id:"legacy-package-management",title:"Legacy Package Management",description:"Migrating from lerna bootstrap, lerna add and lerna link in lerna v7 and later",source:"@site/docs/legacy-package-management.md",sourceDirName:".",slug:"/legacy-package-management",permalink:"/docs/legacy-package-management",draft:!1,editUrl:"https://github.com/lerna/lerna/tree/main/website/docs/legacy-package-management.md",tags:[],version:"current",frontMatter:{id:"legacy-package-management",title:"Legacy Package Management",type:"explainer"},sidebar:"main",previous:{title:"Lerna and Nx Version Matrix",permalink:"/docs/lerna-and-nx-version-matrix"},next:{title:"FAQ",permalink:"/docs/faq"}},p={},s=[{value:"Migrating from <code>lerna bootstrap</code>, <code>lerna add</code> and <code>lerna link</code> in lerna v7 and later",id:"migrating-from-lerna-bootstrap-lerna-add-and-lerna-link-in-lerna-v7-and-later",level:2},{value:"Replacing your usage of <code>lerna bootstrap</code>/<code>lerna link</code>",id:"replacing-your-usage-of-lerna-bootstraplerna-link",level:3},{value:"What does it do?",id:"what-does-it-do",level:4},{value:"Where would I find it?",id:"where-would-i-find-it",level:4},{value:"What do I replace it with?",id:"what-do-i-replace-it-with",level:4},{value:"Replacing your usage of <code>lerna add</code>",id:"replacing-your-usage-of-lerna-add",level:3},{value:"What does it do?",id:"what-does-it-do-1",level:4},{value:"Where would I find it?",id:"where-would-i-find-it-1",level:4},{value:"What do I replace it with?",id:"what-do-i-replace-it-with-1",level:4},{value:"Custom Hoisting",id:"custom-hoisting",level:3},{value:"Temporarily polyfilling legacy package management commands",id:"temporarily-polyfilling-legacy-package-management-commands",level:3},{value:"Background",id:"background",level:2}],d={toc:s};function c(e){let{components:a,...n}=e;return(0,i.kt)("wrapper",(0,t.Z)({},d,n,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"legacy-package-management"},"Legacy Package Management"),(0,i.kt)("iframe",{height:"400",src:"https://www.youtube.com/embed/NEFJNz4wx1k",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen",allowfullscreen:!0}),(0,i.kt)("h2",{id:"migrating-from-lerna-bootstrap-lerna-add-and-lerna-link-in-lerna-v7-and-later"},"Migrating from ",(0,i.kt)("inlineCode",{parentName:"h2"},"lerna bootstrap"),", ",(0,i.kt)("inlineCode",{parentName:"h2"},"lerna add")," and ",(0,i.kt)("inlineCode",{parentName:"h2"},"lerna link")," in lerna v7 and later"),(0,i.kt)("p",null,"In lerna v7.0.0, we removed the ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna add")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna link")," commands in lerna by default."),(0,i.kt)("p",null,"This section covers how best to migrate away from using them and modernize your setup using package manager ",(0,i.kt)("inlineCode",{parentName:"p"},"workspaces"),". For full context on ",(0,i.kt)("em",{parentName:"p"},"why")," this necessary, see ",(0,i.kt)("a",{parentName:"p",href:"#background"},"Background")," below."),(0,i.kt)("p",null,"The important mental shift is to recognize that lerna is not responsible for installing and linking your dependencies in your repo, your package manager is much better suited to that task."),(0,i.kt)("p",null,"The way to achieve this is by using your package manager's ",(0,i.kt)("inlineCode",{parentName:"p"},"workspaces")," feature. See their respective documentation here:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"npm")," (",(0,i.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/cli/using-npm/workspaces"},"https://docs.npmjs.com/cli/using-npm/workspaces"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"yarn")," (",(0,i.kt)("a",{parentName:"li",href:"https://yarnpkg.com/features/workspaces"},"https://yarnpkg.com/features/workspaces"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"pnpm")," (",(0,i.kt)("a",{parentName:"li",href:"https://pnpm.io/workspaces"},"https://pnpm.io/workspaces"),")")),(0,i.kt)("p",null,"By using ",(0,i.kt)("inlineCode",{parentName:"p"},"workspaces"),", your package manager will perform the same exact linking that ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna link")," were doing for you before, except it is baked right into the ",(0,i.kt)("inlineCode",{parentName:"p"},"install")," command. No additional commands after running an install are necessary (as long as you have ",(0,i.kt)("inlineCode",{parentName:"p"},"workspaces")," configured per the package manager documentation above)."),(0,i.kt)("p",null,"The same thing goes for replacing ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna add"),". Adding and removing dependencies is something your package manager already does for you, and because ",(0,i.kt)("inlineCode",{parentName:"p"},"workspaces")," is a first class use case, you can run an appropriate ",(0,i.kt)("inlineCode",{parentName:"p"},"install")," command to add a dependency to a specific package/workspace and, again, all the relevant local linking will take place automatically."),(0,i.kt)("p",null,"See below for more concrete comparisons, and before and after usage."),(0,i.kt)("h3",{id:"replacing-your-usage-of-lerna-bootstraplerna-link"},"Replacing your usage of ",(0,i.kt)("inlineCode",{parentName:"h3"},"lerna bootstrap"),"/",(0,i.kt)("inlineCode",{parentName:"h3"},"lerna link")),(0,i.kt)("h4",{id:"what-does-it-do"},"What does it do?"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap")," was used in place of ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install")," (or ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm"),"). It would install all external packages and link all internal packages within the workspace. ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna link")," would just perform the internal linking step of this operation."),(0,i.kt)("h4",{id:"where-would-i-find-it"},"Where would I find it?"),(0,i.kt)("p",null,'It would most likely be in the "scripts" property of ',(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," in the root of your workspace. Also check your CI pipelines, as they might also be calling ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap")," in place of ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install")," (or ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm"),")."),(0,i.kt)("h4",{id:"what-do-i-replace-it-with"},"What do I replace it with?"),(0,i.kt)("p",null,"Replace ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install")," (or ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm"),"). If you are already performing your package manager's install command somewhere in your workflow before where you had previously called ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap"),", then you can just delete it instead. ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna link")," can just be removed, as the linking step is now handled by your package manager during ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install"),"."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"If you are using ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn")," and depend on linking binaries, then you may need to delete your ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," folder once after switching to workspaces. For details, see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/yarnpkg/yarn/issues/4964#issuecomment-358709008"},"this yarn issue"),".")),(0,i.kt)("h3",{id:"replacing-your-usage-of-lerna-add"},"Replacing your usage of ",(0,i.kt)("inlineCode",{parentName:"h3"},"lerna add")),(0,i.kt)("h4",{id:"what-does-it-do-1"},"What does it do?"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"lerna add")," was used to add a dependency to packages in the workspace. It would update the ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," files of each package to add the dependency."),(0,i.kt)("h4",{id:"where-would-i-find-it-1"},"Where would I find it?"),(0,i.kt)("p",null,"Though usually called manually, ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna add")," might be found in some scripts in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," in the root of your workspace."),(0,i.kt)("h4",{id:"what-do-i-replace-it-with-1"},"What do I replace it with?"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"lerna add")," can mostly be replaced with a variation of ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install")," (or ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm"),"). The most common use case for ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna add")," was to add a single dependency to a single package within the workspace. This command looks like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"lerna add <dependency> --scope <package>\n")),(0,i.kt)("p",null,"and can be replaced directly with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"npm install <dependency> -w <package>\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"-w")," flag tells npm to only install the dependency in the workspace package specified by ",(0,i.kt)("inlineCode",{parentName:"p"},"<package>"),", similar to the ",(0,i.kt)("inlineCode",{parentName:"p"},"--scope")," option for Lerna."),(0,i.kt)("p",null,"If you need to add a dependency to multiple packages, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"-w")," option multiple times:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"npm install <dependency> -w <package1> -w <package2>\n")),(0,i.kt)("h3",{id:"custom-hoisting"},"Custom Hoisting"),(0,i.kt)("p",null,"One of the nice things about lerna's legacy ",(0,i.kt)("inlineCode",{parentName:"p"},"bootstrap")," command was the control it offered you around hoisting or not hoisting certain dependencies up to the root of the repo, or leaving them in nested locations."),(0,i.kt)("p",null,"Therefore you may be concerned about migrating away from ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap")," if you have quite a custom setup in terms of package hoisting."),(0,i.kt)("p",null,"In our experience of testing out the various package managers, we have found that modern ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn")," (i.e. v3 and later) offers the most flexibility in terms of hoisting controls:"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://yarnpkg.com/configuration/yarnrc/#nmHoistingLimits"},"https://yarnpkg.com/configuration/yarnrc/#nmHoistingLimits")),(0,i.kt)("p",null,"We have yet to find a ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap")," powered repo, no matter the hoisting complexities, that could not be converted to modern yarn, so please try it out if this applies to you."),(0,i.kt)("p",null,"If you were just using ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap")," without any advanced hoisting concerns, feel free to choose from any of the package managers, they all offer robust ",(0,i.kt)("inlineCode",{parentName:"p"},"workspaces")," implementations."),(0,i.kt)("h3",{id:"temporarily-polyfilling-legacy-package-management-commands"},"Temporarily polyfilling legacy package management commands"),(0,i.kt)("p",null,"If you really find yourself stuck and needing the legacy package management commands of ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna add")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna link")," in v7, you can install the ",(0,i.kt)("inlineCode",{parentName:"p"},"@lerna/legacy-package-management")," package at the same version as your ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna")," package, and this will polyfill the commands with their old implementations."),(0,i.kt)("p",null,"It's important to note that this is just a stop gap and this new package can be thought of as being in maintenance mode only - no new features will be considered for legacy package management concerns (such as ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna add")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna link"),"), and we will only look to merge critical patches and security updates."),(0,i.kt)("p",null,"If you find yourself in this position, please open an issue on the lerna repo so that we can learn more about the difficulties you are facing and help you find a way forward:"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/lerna/lerna/issues/new/choose"},"https://github.com/lerna/lerna/issues/new/choose")),(0,i.kt)("h2",{id:"background"},"Background"),(0,i.kt)("p",null,'Lerna is the original monorepo/workspace tool in the JavaScript ecosystem. When it was created in 2015/2016 the ecosystem looked totally different, and there were no built in capabilities to handle working with multiple packages in a single repository (a "workspace"). Commands like ',(0,i.kt)("inlineCode",{parentName:"p"},"lerna bootstrap"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna add")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"lerna link")," were all a critical part of the lerna project, because there were no other options."),(0,i.kt)("p",null,"However, the fact is that - for many years now - the package managers we know and love (",(0,i.kt)("inlineCode",{parentName:"p"},"npm"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm"),") all fully support that concept of workspaces as a first-class use-case."),(0,i.kt)("p",null,"They have battle tested implementations covering adding, removing and linking local packages, and combining them with third party dependencies in a natural way."),(0,i.kt)("p",null,"This is the reason why, for the final several years of his tenure as lead maintainer of lerna, Daniel, had been encouraging folks to strongly reconsider their use of the legacy package management commands in lerna, and instead leverage their package manager of choice to do what it does best."),(0,i.kt)("p",null,"We knew about this context from afar, but as new stewards of the project in 2022 we did not want to jump straight in and start removing capabilities without first taking the time to get familiar with the reality up close. Now that we have been actively maintaining for a while, we are in full agreement with Daniel and others that the legacy package management commands in lerna needed to be retired."),(0,i.kt)("p",null,"By removing these legacy pieces which have better alternatives natively in package managers, we and the rest of the lerna community are now freed up to concentrate our efforts on things which are uniquely valuable about lerna (such as, but not limited to, versioning and publishing), and making them the best they can be!"),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"This same context is covered on the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lerna/lerna/discussions/3410"},"Lerna v7 discussion"),", if you have any specific concerns, please join us there and provide as much information as possible!")))}c.isMDXComponent=!0}}]);