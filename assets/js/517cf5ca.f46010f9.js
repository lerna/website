"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[868],{8120:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>o,frontMatter:()=>r,metadata:()=>c,toc:()=>h});const c=JSON.parse('{"id":"features/workspace-watching","title":"Workspace Watching","description":"Workspace Watching is available as of Lerna 6.4.0.","source":"@site/docs/features/workspace-watching.md","sourceDirName":"features","slug":"/features/workspace-watching","permalink":"/docs/features/workspace-watching","draft":false,"unlisted":false,"editUrl":"https://github.com/lerna/lerna/tree/main/website/docs/features/workspace-watching.md","tags":[],"version":"current","frontMatter":{"id":"workspace-watching","title":"Workspace Watching","type":"recipe"},"sidebar":"main","previous":{"title":"Editor Integrations","permalink":"/docs/features/editor-integrations"},"next":{"title":"Concepts","permalink":"/docs/concepts"}}');var s=a(4848),i=a(8453);const r={id:"workspace-watching",title:"Workspace Watching",type:"recipe"},t="Workspace Watching",l={},h=[{value:"Examples",id:"examples",level:2},{value:"Watch Environment Variables",id:"watch-environment-variables",level:2},{value:"Running With Package Managers",id:"running-with-package-managers",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"workspace-watching",children:"Workspace Watching"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Workspace Watching is available as of Lerna 6.4.0."})}),"\n",(0,s.jsx)(n.p,{children:"Lerna can watch for file changes within packages and automatically execute commands from the root of the repository. This is useful if you need to rebuild packages or rerun tests as you update files during your development workflow."}),"\n",(0,s.jsx)(n.p,{children:"This replaces the need to manually set up watching for each package individually."}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(n.p,{children:"Watch all packages and echo the package name and the files that changed:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"$ lerna watch -- echo \\$LERNA_PACKAGE_NAME \\$LERNA_FILE_CHANGES\n"})}),"\n",(0,s.jsx)(n.p,{children:'Watch all packages and run the "build" script on a package when a file within it changes:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"$ lerna watch -- lerna run build --scope=\\$LERNA_PACKAGE_NAME\n"})}),"\n",(0,s.jsx)(n.p,{children:'Watch all packages and run the "build" script on everything affected by the changes:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"$ lerna watch -- lerna run build --since\n"})}),"\n",(0,s.jsx)(n.p,{children:'Watch a single package and run the "build" script on it when a file within it changes:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:'$ lerna watch --scope="my-package-1" -- lerna run build --scope=\\$LERNA_PACKAGE_NAME\n'})}),"\n",(0,s.jsx)(n.p,{children:'Watch a single package and its dependencies, running the "build" script on any of them that change:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:'$ lerna watch --scope="my-package-1" --include-dependencies -- lerna run build --scope=\\$LERNA_PACKAGE_NAME\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Watch all packages and run the ",(0,s.jsx)(n.code,{children:"build"})," script for the package that changed and all packages that depend on it:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"$ lerna watch -- lerna run build --scope=\\$LERNA_PACKAGE_NAME --include-dependents\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For more advanced filtering, see the ",(0,s.jsx)(n.a,{href:"https://lerna.js.org/docs/api-reference/commands#filter-options",children:"filter options"})," documentation. For more available options, see the ",(0,s.jsx)(n.a,{href:"https://github.com/lerna/lerna/tree/main/packages/lerna/src/commands/watch#lerna-watch",children:(0,s.jsx)(n.code,{children:"lerna watch"})})," documentation."]}),"\n",(0,s.jsx)(n.h2,{id:"watch-environment-variables",children:"Watch Environment Variables"}),"\n",(0,s.jsxs)(n.p,{children:["Lerna will set the environment variables ",(0,s.jsx)(n.code,{children:"$LERNA_PACKAGE_NAME"})," and ",(0,s.jsx)(n.code,{children:"$LERNA_FILE_CHANGES"})," when running the inner command. These can be used to customize the command that is run."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$LERNA_PACKAGE_NAME"})," will be replaced with the name of the package that changed."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$LERNA_FILE_CHANGES"})," will be replaced with the file(s) that changed. If multiple file changes are detected in one cycle, then ",(0,s.jsx)(n.code,{children:"$LERNA_FILE_CHANGES"})," will list them all, separated by spaces."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["When using ",(0,s.jsx)(n.code,{children:"$LERNA_PACKAGE_NAME"})," and ",(0,s.jsx)(n.code,{children:"$LERNA_FILE_CHANGES"}),", you will need to escape the ",(0,s.jsx)(n.code,{children:"$"})," with a backslash (",(0,s.jsx)(n.code,{children:"\\"}),"). See the ",(0,s.jsx)(n.a,{href:"#examples",children:"examples"})," above."]})}),"\n",(0,s.jsx)(n.h2,{id:"running-with-package-managers",children:"Running With Package Managers"}),"\n",(0,s.jsxs)(n.p,{children:["The examples above showcase using ",(0,s.jsx)(n.code,{children:"lerna"})," directly in the terminal. However, you can also use ",(0,s.jsx)(n.code,{children:"lerna"})," via a package manager without adding it to your path:"]}),"\n",(0,s.jsx)(n.p,{children:"pnpm:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pnpm lerna watch -- lerna run build --scope=\\$LERNA_PACKAGE_NAME\n"})}),"\n",(0,s.jsx)(n.p,{children:"yarn:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn lerna -- watch -- lerna run build --scope=\\$LERNA_PACKAGE_NAME\n"})}),"\n",(0,s.jsx)(n.p,{children:"npx:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx -c 'lerna watch -- lerna run build --scope=\\$LERNA_PACKAGE_NAME'\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["When using ",(0,s.jsx)(n.code,{children:"npx"}),", you will need to use ",(0,s.jsx)(n.code,{children:"-c"})," and surround the entire ",(0,s.jsx)(n.code,{children:"lerna watch"})," command in single quotes (",(0,s.jsx)(n.code,{children:"'"}),"). Without this, ",(0,s.jsx)(n.code,{children:"npx"})," will try to replace the ",(0,s.jsx)(n.a,{href:"#watch-environment-variables",children:"watch environment variables"})," before passing the command to ",(0,s.jsx)(n.code,{children:"lerna"}),", resulting in an always empty value for ",(0,s.jsx)(n.code,{children:"$LERNA_PACKAGE_NAME"})," and ",(0,s.jsx)(n.code,{children:"$LERNA_FILE_CHANGES"}),"."]})}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)(n.p,{children:"If you use Lerna in Windows, you must frame environment variables in '%'. For example:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"$ lerna watch -- lerna run build --scope=%LERNA_PACKAGE_NAME% --include-dependents\n"})})]})]})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>t});var c=a(6540);const s={},i=c.createContext(s);function r(e){const n=c.useContext(i);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),c.createElement(i.Provider,{value:n},e.children)}}}]);