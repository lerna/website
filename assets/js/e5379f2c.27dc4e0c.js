"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[473],{1742:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var i=n(4848),r=n(8453);const s={id:"utilities",title:"Utilities",type:"reference"},o="Utilities",c={id:"api-reference/utilities",title:"Utilities",description:"Lerna ships some utility functions that can be used in creating your own tools within a Lerna monorepo.",source:"@site/docs/api-reference/utilities.md",sourceDirName:"api-reference",slug:"/api-reference/utilities",permalink:"/docs/api-reference/utilities",draft:!1,unlisted:!1,editUrl:"https://github.com/lerna/lerna/tree/main/website/docs/api-reference/utilities.md",tags:[],version:"current",frontMatter:{id:"utilities",title:"Utilities",type:"reference"},sidebar:"main",previous:{title:"Configuration",permalink:"/docs/api-reference/configuration"},next:{title:"Lerna and Nx Version Matrix",permalink:"/docs/lerna-and-nx-version-matrix"}},a={},d=[{value:"<code>detectProjects()</code>",id:"detectprojects",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"utilities",children:"Utilities"})}),"\n",(0,i.jsx)(t.p,{children:"Lerna ships some utility functions that can be used in creating your own tools within a Lerna monorepo."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'const utils = require("lerna/utils");\n'})}),"\n",(0,i.jsx)(t.h2,{id:"detectprojects",children:(0,i.jsx)(t.code,{children:"detectProjects()"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"detectProjects()"})," function creates the same project graph file mapping that Lerna uses under the covers to execute its commands. This is useful for writing your own scripts that need to operate on the same set of packages that Lerna would. You may pass a parameter for a custom working directory to the function if you need to use a different workspace root."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'const path = require("path");\nconst { detectProjects } = require("lerna/utils");\n\nconst { projectGraph, projectFileMap } = await detectProjects();\nconst { projectGraph, projectFileMap } = await detectProjects(path.resolve("./custom-workspace-root"));\n'})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"projectGraph"})," that is returned will be a ",(0,i.jsx)(t.code,{children:"ProjectGraphWithPackages"}),", which is an extension of the ",(0,i.jsx)(t.code,{children:"ProjectGraph"})," type from ",(0,i.jsx)(t.code,{children:"@nx/devkit"}),". It contains additional metadata about projects that have ",(0,i.jsx)(t.code,{children:"package.json"})," files. It also has a ",(0,i.jsx)(t.code,{children:"localPackageDependencies"})," property that tracks internal npm dependencies between projects (as opposed to external npm dependencies that are downloaded from the registry)."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"projectFileMap"})," is a mapping of project names to the files within them. This is used to determine which project needs to be versioned when a file changes."]}),"\n",(0,i.jsxs)(t.p,{children:["See ",(0,i.jsx)(t.a,{href:"https://github.com/lerna/lerna/blob/main/libs/core/src/lib/project-graph-with-packages.ts",children:"Lerna's TypeScript source code"})," for specific type details."]})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>c});var i=n(6540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);